echo "============ Update / Homebrew ============"

# Install a previous version (v0.1.1)
brew tap sherpalabsio/sherpalabsio
cd $(brew --repository)/Library/Taps/sherpalabsio/homebrew-sherpalabsio
git checkout db01e2ed2a358f98ac1df4014fd79b09dc1dc4ff

brew install sherpalabsio/sherpalabsio/local_sherpa

git checkout main

source ~/.bashrc

sherpa diagnose > /dev/null || {
  echo "Installation failed. sherpa diagnose returned an error."
  exit 1
}

current_version=$(sherpa --version)

sherpa update

source ~/.bashrc

updated_version=$(sherpa --version)

if [ "$current_version" == "$updated_version" ]; then
  echo "failed: current version ($current_version) is the same as updated version ($updated_version)."
  exit 1
fi
